<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merge fractions • visProteomics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Merge fractions">
<meta property="og:description" content="Often when analysing the fractionated sample, we get a separate file of proteins for every fraction. This vignette shows how to easily merge these files and produce the clean data frame which may be used by other functions of this package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">visProteomics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/merge-fractions.html">Merge fractions</a>
    </li>
    <li>
      <a href="../articles/vis-fractions.html">Visualize and explore fractions</a>
    </li>
    <li>
      <a href="../articles/explore-venn.html">Explore Venn diagram</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="merge-fractions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Merge fractions</h1>
            
      
      
      <div class="hidden name"><code>merge-fractions.Rmd</code></div>

    </div>

    
    
<p>visProteomics functions are intended for exploration and visualization of fractions of the analyzed fractionated sample. To use the function we need one tidy data frame with all proteins from all fractions listed in rows and with two required columns, one giving the protein ID and another with the number of fraction in which the protein is detected. Additional columns with further protein description can be added and used in visualization/exploration.</p>
<p>In this vignette, we demonstrate how to create a tidy data frame of proteins step by step, with easily understandable R function calls. There are other, possibly more efficient approaches, however, we wanted the code to be easy to understand and customize even for R beginners.</p>
<div id="uploading-and-merging-data" class="section level2">
<h2 class="hasAnchor">
<a href="#uploading-and-merging-data" class="anchor"></a>Uploading and merging data</h2>
<p>Algorithms for protein detection usually return a separate list of detected proteins for every fraction. This means that for every fraction of the fractionated sample we have a separate file. We want to merge all these files in one tidy data frame. The easiest way is to put all files in one folder and to follow a specific pattern in naming files so that the fraction number is easily read from the file name. For demonstration, we saved all files in the folder “data-fractions” and named them as "?_Fract_proteins_visProteomics.txt“, where”?" is a fraction number. In our case, all files are saved in the folder “./data-fractions/”. We use the following code to create a new data frame.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">folder_name</span> <span class="op">&lt;-</span> <span class="st">"./data-fractions/"</span> <span class="co">#name of the folder with saved files</span>
<span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path<span class="op">=</span><span class="va">folder_name</span>, pattern <span class="op">=</span> <span class="st">"*.txt"</span><span class="op">)</span> <span class="co">#extracts names of all files in the folder with the given pattern</span>
<span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">folder_name</span>, <span class="va">file_names</span><span class="op">)</span>
<span class="va">number_of_fractions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">file_names</span><span class="op">)</span> <span class="co">#number of fractions equals the number of files in the folder</span>
<span class="va">data_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">file_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, header<span class="op">=</span><span class="cn">T</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span>, sep<span class="op">=</span><span class="st">'\t'</span><span class="op">)</span> <span class="co">#save the first </span>
<span class="va">data_total</span><span class="op">$</span><span class="va">Fraction_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="va">folder_name</span>, <span class="st">""</span>, <span class="va">file_names</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co">#add fraction number: remove the folder name and take the number before the first underscore (this will depend on the naming pattern)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">number_of_fractions</span><span class="op">)</span><span class="op">{</span>
  <span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">file_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, header<span class="op">=</span><span class="cn">T</span>, stringsAsFactors <span class="op">=</span> <span class="cn">F</span>, sep<span class="op">=</span><span class="st">'\t'</span><span class="op">)</span> <span class="co">#read one of the files</span>
  <span class="va">df_temp</span><span class="op">$</span><span class="va">Fraction_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="va">folder_name</span>, <span class="st">""</span>, <span class="va">file_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="st">"_"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co">#add fraction number</span>
  <span class="va">data_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">data_total</span>, <span class="va">df_temp</span><span class="op">)</span> <span class="co"># we add this fraction to the data_total</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="tidying-up-the-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#tidying-up-the-data-frame" class="anchor"></a>Tidying up the data frame</h2>
<p>Now we may want to tidy up our data frame: rename columns, remove or add columns, check whether the format of columns is correct.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Accession'</span>, <span class="st">'Description'</span>, <span class="st">'Sum_Coverage'</span>,<span class="st">'Sum_Proteins'</span>,
                          <span class="st">'Sum_Unique_Peptides'</span>, <span class="st">'Sum_Peptides'</span>, <span class="st">'Sum_PSM'</span>, <span class="st">'Peptides_Mascot'</span>,
                          <span class="st">'Peptides_Sequest'</span>, <span class="st">'PSM_Mascot'</span>,<span class="st">'PSM_Sequest'</span>, <span class="st">'Coverage_Mascot'</span>,
                          <span class="st">'Coverage_Sequest'</span>, <span class="st">'Score_Mascot'</span>,<span class="st">'Score_Sequest'</span>, <span class="st">'AAs'</span>, <span class="st">'MW_kDa'</span>, <span class="st">'pI'</span>, <span class="st">'Fraction_Number'</span><span class="op">)</span>
<span class="va">data_total</span> <span class="op">&lt;-</span> <span class="va">data_total</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Accession'</span>, <span class="st">'Description'</span>, <span class="st">'Sum_Coverage'</span>, <span class="st">'Sum_Proteins'</span>,
                          <span class="st">'Sum_Unique_Peptides'</span>, <span class="st">'Sum_Peptides'</span>, <span class="st">'AAs'</span>, <span class="st">'MW_kDa'</span>, <span class="st">'pI'</span>, <span class="st">'Fraction_Number'</span><span class="op">)</span><span class="op">]</span>
<span class="va">data_total</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span> <span class="co">#view the first 5 rows</span>
<span class="co">#&gt;   Accession</span>
<span class="co">#&gt; 1    P02768</span>
<span class="co">#&gt; 2    P00915</span>
<span class="co">#&gt; 3    P31944</span>
<span class="co">#&gt; 4    Q14118</span>
<span class="co">#&gt; 5    P02671</span>
<span class="co">#&gt;                                                              Description</span>
<span class="co">#&gt; 1          Serum albumin OS=Homo sapiens GN=ALB PE=1 SV=2 - [ALBU_HUMAN]</span>
<span class="co">#&gt; 2   Carbonic anhydrase 1 OS=Homo sapiens GN=CA1 PE=1 SV=2 - [CAH1_HUMAN]</span>
<span class="co">#&gt; 3         Caspase-14 OS=Homo sapiens GN=CASP14 PE=1 SV=2 - [CASPE_HUMAN]</span>
<span class="co">#&gt; 4          Dystroglycan OS=Homo sapiens GN=DAG1 PE=1 SV=2 - [DAG1_HUMAN]</span>
<span class="co">#&gt; 5 Fibrinogen alpha chain OS=Homo sapiens GN=FGA PE=1 SV=2 - [FIBA_HUMAN]</span>
<span class="co">#&gt;   Sum_Coverage Sum_Proteins Sum_Unique_Peptides Sum_Peptides AAs MW_kDa   pI</span>
<span class="co">#&gt; 1      22.99 %            6                  16           16 609   69.3 6.28</span>
<span class="co">#&gt; 2      35.63 %            3                   7            7 261   28.9 7.12</span>
<span class="co">#&gt; 3      14.46 %            1                   4            4 242   27.7 5.58</span>
<span class="co">#&gt; 4       3.80 %            1                   3            3 895   97.4 8.56</span>
<span class="co">#&gt; 5       2.54 %            1                   2            2 866   94.9 6.01</span>
<span class="co">#&gt;   Fraction_Number</span>
<span class="co">#&gt; 1               1</span>
<span class="co">#&gt; 2               1</span>
<span class="co">#&gt; 3               1</span>
<span class="co">#&gt; 4               1</span>
<span class="co">#&gt; 5               1</span></code></pre></div>
<p>The column ‘Sum_Coverage’ should be numeric. Also, we want shorter ‘Description’ of proteins: the first part of the string before ‘OS=’.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_total</span><span class="op">$</span><span class="va">Sum_Coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">$</span><span class="va">Sum_Coverage</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"%"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#convert percentage to number</span>
<span class="va">data_total</span><span class="op">$</span><span class="va">Description_Trimmed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">$</span><span class="va">Description</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" OS="</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co">#add additional row with description</span>
<span class="va">data_total</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Accession'</span>, <span class="st">'Sum_Coverage'</span>, <span class="st">'Description_Trimmed'</span><span class="op">)</span><span class="op">]</span> <span class="co"># check changed columns</span>
<span class="co">#&gt;   Accession Sum_Coverage    Description_Trimmed</span>
<span class="co">#&gt; 1    P02768        22.99          Serum albumin</span>
<span class="co">#&gt; 2    P00915        35.63   Carbonic anhydrase 1</span>
<span class="co">#&gt; 3    P31944        14.46             Caspase-14</span>
<span class="co">#&gt; 4    Q14118         3.80           Dystroglycan</span>
<span class="co">#&gt; 5    P02671         2.54 Fibrinogen alpha chain</span></code></pre></div>
<p>We may want to remove some proteins in which we are not interested. We can do it based on their ID, their description or some other column. For example, we may want to remove all proteins described as “keratin” and keep only the first 20 proteins from each fraction based on ‘Sum_Peptides’.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_total</span> <span class="op">&lt;-</span> <span class="va">data_total</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'keratin'</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">$</span><span class="va">Description</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="co">#remove proteins described as 'keratin' (regardless of uppercase characters)</span>
<span class="va">data_top20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co">#create new empty data frame</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_top20</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">)</span>
<span class="va">fraction_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">data_total</span><span class="op">$</span><span class="va">Fraction_Number</span><span class="op">)</span> <span class="co">#all fractions</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">fraction_names</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="va">data_total</span><span class="op">[</span><span class="va">data_total</span><span class="op">$</span><span class="va">Fraction_Number</span><span class="op">==</span><span class="va">fraction_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span> <span class="co">#only proteins in the ith fraction</span>
  <span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="va">df_temp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">$</span><span class="va">Sum_Peptides</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span> <span class="co">#order proteins by Sum_Peptides</span>
  <span class="va">data_top20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">data_top20</span>, <span class="va">df_temp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df_temp</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span> <span class="co">#keep the first 20 proteins</span>
<span class="op">}</span></code></pre></div>
<p>The resulting two data frames are included in the package and can be loaded with ‘data’ function.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Iva Budimir, IMforFUTURE.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
